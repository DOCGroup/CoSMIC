<?xml version='1.0' encoding='Windows-1252' ?>

<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi'>
  <?define COSMIC_ROOT = $(env.COSMIC_ROOT) ?>
  <?define COSMIC_BIN  = $(var.COSMIC_ROOT)/bin ?>

  <Product Name="CUTS Modeling Tools for CoSMIC"
           Id="9A601859-E2D1-4C1F-B897-B13fEA0261B0"
           UpgradeCode="1CEF4517-4472-4A6F-8D4E-4D5B5F3B240A"
           Language="1033" Codepage="1252" Version="0.2"
           Manufacturer="DOC Group, ISIS, Vanderbilt University">

    <Package Keywords='Installer'
             Description='CUTS Modeling Tools for CoSMIC'
             Manufacturer='DOC Group, ISIS, Vanderbilt University'
             InstallerVersion='100' Languages='1033' Compressed='yes'
             SummaryCodepage='1252' />

    <!-- Wix variables -->
    <WixVariable Id="WixUILicenseRtf" Value="License.rtf" />
    <WixVariable Id="WixUIBannerBmp"  Value="Bitmaps\bannrbmp.bmp" />
    <WixVariable Id="WixUIDialogBmp"  Value="Bitmaps\dlgbmp.bmp" />

    <!-- properties -->
    <Property Id="PICML_INSTALLED">
      <RegistrySearch Id="PICML_version" Root="HKLM" Type="raw"
                      Key="SOFTWARE\GME\Paradigms\PICML" Name="CurrentVersion" />
    </Property>

    <!-- installation conditions -->
    <Condition Message='CUTS modeling tools requires CoSMIC to be installed'>
      PICML_INSTALLED</Condition>

    <!-- installation media -->
    <Media Id="1" Cabinet="CUTS_CoSMIC.cab" EmbedCab="yes" />

    <Directory Id='TARGETDIR' Name='SourceDir'>
      <Directory Id="WindowsFolder" Name="WINDOWS" />
      <Directory Id="ProgramFilesFolder" Name="PFiles">
        <Directory Id="INSTALLDIR" Name="CoSMIC">
          <Directory Id="bin" Name="bin">
            <Component Id="CUTS_components"
                       Guid="6EE61FA3-D86A-4325-99E5-35E96DCA8095"
                       Location="local">

              <File Id="CUTS_PICML.dll" Name="CUTS_PICML.dll"
                    Source="$(var.COSMIC_BIN)\CUTS_PICML.dll" DiskId="1" />

              <File Id="CUTS_BE_CIAO.dll" Name="CUTS_BE_CIAO.dll"
                    Source="$(var.COSMIC_BIN)\CUTS_BE_CIAO.dll" DiskId="1" />

              <File Id="CUTS_BE.dll" Name="CUTS_BE.dll"
                    Source="$(var.COSMIC_BIN)\CUTS_BE.dll" DiskId="1" />

              <!-- GME registry information -->
              <RegistryKey Root="HKLM"
                           Key="SOFTWARE\GME\Components\CUTS.Interpreter.PICML"
                           Action="createAndRemoveOnUninstall">
                <RegistryValue Name="Description" Type="string"
                               Value="CUTS Interpreter" Action="write" />
                <RegistryValue Name="Icon" Type="string"
                               Value=",IDI_COMPICON" Action="write" />
                <RegistryValue Name="Paradigm" Type="string"
                               Value="PICML" Action="write" />
                <RegistryValue Name="Tooltip" Type="string"
                               Value="CUTS interpreter" Action="write" />
                <RegistryValue Name="Type" Type="integer"
                               Value="1" Action="write" />
                <RegistryKey Key="Associated" Action="create">
                  <RegistryValue Name="PICML" Type="string"
                                 Action="write" Value="" />
                </RegistryKey>
              </RegistryKey>

              <!-- ProgID registry information -->
              <RegistryKey Root="HKCR"
                           Key="CUTS.Interpreter.PICML"
                           Action="createAndRemoveOnUninstall">
                <RegistryValue Type="string" Value="CUTS.Interpreter.PICML" />
                <RegistryKey Key="CLSID" Action="create">
                  <RegistryValue Type="string"
                                 Value="{DD5752C3-12EF-43D0-978C-F5C395D5BF13}" />
                </RegistryKey>
              </RegistryKey>

              <!-- CLSID registry information -->
              <RegistryKey Root="HKCR"
                           Key="CLSID\{DD5752C3-12EF-43D0-978C-F5C395D5BF13}"
                           Action="createAndRemoveOnUninstall">
                <RegistryValue Type="string"
                               Value="CUTS.Interpreter.PICML" />

                <RegistryKey Key="InProcServer32" Action="create">
                  <RegistryValue Type="string"
                                 Value="[INSTALLDIR]bin\CUTS_PICML.dll" />
                </RegistryKey>

                <RegistryKey Key="ProgID" Action="create">
                  <RegistryValue Type="string" Value="CUTS.Interpreter.PICML" />
                </RegistryKey>
              </RegistryKey>

            </Component>
          </Directory>
        </Directory>
      </Directory>
    </Directory>

    <!-- product features -->
    <Feature Id="CUTS_CoSMIC_feature" Title="CUTS Modeling Tools"
             Display="collapse" Absent="disallow"
             Description="Installs the default CUTS modeling tools for CoSMIC"
             Level="1" ConfigurableDirectory="INSTALLDIR"
             AllowAdvertise="no">
      <ComponentRef Id="CUTS_components" />

      <!-- components from CoSMIC_common -->
      <ComponentRef Id="CoSMIC_utils" />
      <ComponentRef Id="PICML" />
      <ComponentRef Id="UDM_3_1_1" />

      <!-- include the VC merge modules -->
      <FeatureRef Id="vc_merge_modules" />
    </Feature>

    <!-- user interface -->
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />

    <UIRef Id="WixUI_Mondo" />
    <UIRef Id="WixUI_ErrorProgressText" />
  </Product>
</Wix>
